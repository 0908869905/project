# API æ–‡ä»¶ | API Documentation

## æ¦‚è¿°

é€™ä»½æ–‡ä»¶æè¿°äº†æ–‡å­—è½‰æ‰‹èªç¶²ç«™çš„å¾Œç«¯ API ç«¯é»ã€‚

**Base URL**: `http://localhost:3001` (é–‹ç™¼ç’°å¢ƒ)

---

## ç«¯é»ç¸½è¦½

| ç«¯é» | æ–¹æ³• | èªªæ˜ | èªè­‰ |
|------|------|------|------|
| `/api/health` | GET | å¥åº·æª¢æŸ¥ | å¦ |
| `/api/translate` | POST | ä¸­æ–‡è½‰ TSL Gloss | å¦ |
| `/api/generate` | POST | Gloss ç”Ÿæˆåœ–ç‰‡ | å¦ |
| `/api/translate-complete` | POST | å®Œæ•´ç¿»è­¯æµç¨‹ | å¦ |
| `/api/postprocess` | POST | è™•ç†ä½¿ç”¨è€…å›é¥‹ | å¦ |
| `/api/stats` | GET | ç²å–çµ±è¨ˆè³‡æ–™ | å¦ |

---

## è©³ç´°ç«¯é»èªªæ˜

### 1. å¥åº·æª¢æŸ¥

æª¢æŸ¥ API æœå‹™æ˜¯å¦æ­£å¸¸é‹è¡Œã€‚

**ç«¯é»**: `GET /api/health`

**è«‹æ±‚ç¯„ä¾‹**:
```bash
curl http://localhost:3001/api/health
```

**å›æ‡‰ç¯„ä¾‹**:
```json
{
  "status": "ok",
  "timestamp": "2024-01-01T00:00:00.000Z"
}
```

**ç‹€æ…‹ç¢¼**:
- `200 OK`: æœå‹™æ­£å¸¸

---

### 2. ç¿»è­¯ä¸­æ–‡åˆ° TSL Gloss

å°‡ä¸­æ–‡æ–‡å­—è½‰æ›ç‚ºå°ç£æ‰‹èª (TSL) Gloss æ¨™è¨˜ã€‚

**ç«¯é»**: `POST /api/translate`

**è«‹æ±‚æ ¼å¼**:
```typescript
{
  text: string  // å¿…å¡«ï¼šè¦ç¿»è­¯çš„ä¸­æ–‡æ–‡å­—
}
```

**è«‹æ±‚ç¯„ä¾‹**:
```bash
curl -X POST http://localhost:3001/api/translate \
  -H "Content-Type: application/json" \
  -d '{"text": "æˆ‘å–œæ­¡å­¸ç¿’æ‰‹èª"}'
```

**å›æ‡‰ç¯„ä¾‹**:
```json
{
  "gloss": "INDEX-1 LIKE LEARN SIGN-LANGUAGE"
}
```

**èªªæ˜**:
- TSL Gloss ä½¿ç”¨å¤§å¯«è‹±æ–‡å–®è©è¡¨ç¤ºæ‰‹èªæ¦‚å¿µ
- `INDEX-1` è¡¨ç¤ºç¬¬ä¸€äººç¨±æŒ‡ç¤º
- å–®è©ä¹‹é–“ç”¨ç©ºæ ¼åˆ†éš”

**ç‹€æ…‹ç¢¼**:
- `201 Created`: ç¿»è­¯æˆåŠŸ
- `400 Bad Request`: è«‹æ±‚æ ¼å¼éŒ¯èª¤
- `500 Internal Server Error`: OpenAI API éŒ¯èª¤

---

### 3. ç”Ÿæˆæ‰‹èªåœ–ç‰‡

å¾ TSL Gloss ç”Ÿæˆæ‰‹èªç¤ºæ„åœ–ç‰‡ã€‚

**ç«¯é»**: `POST /api/generate`

**è«‹æ±‚æ ¼å¼**:
```typescript
{
  gloss: string  // å¿…å¡«ï¼šTSL Gloss æ¨™è¨˜
}
```

**è«‹æ±‚ç¯„ä¾‹**:
```bash
curl -X POST http://localhost:3001/api/generate \
  -H "Content-Type: application/json" \
  -d '{"gloss": "INDEX-1 LIKE LEARN SIGN-LANGUAGE"}'
```

**å›æ‡‰ç¯„ä¾‹**:
```json
{
  "imageUrl": "https://oaidalleapiprodscus.blob.core.windows.net/..."
}
```

**èªªæ˜**:
- ä½¿ç”¨ OpenAI DALL-E 3 ç”Ÿæˆåœ–ç‰‡
- åœ–ç‰‡å°ºå¯¸: 1024x1024
- åœ–ç‰‡ URL æœ‰æ•ˆæœŸé™ä¾ OpenAI æ”¿ç­–
- çµæœæœƒè¢«å¿«å–ä»¥æå‡æ•ˆèƒ½

**ç‹€æ…‹ç¢¼**:
- `201 Created`: ç”ŸæˆæˆåŠŸ
- `400 Bad Request`: è«‹æ±‚æ ¼å¼éŒ¯èª¤
- `500 Internal Server Error`: OpenAI API éŒ¯èª¤

---

### 4. å®Œæ•´ç¿»è­¯æµç¨‹ï¼ˆæ¨è–¦ï¼‰

ä¸€æ¬¡å®Œæˆï¼šæ–‡å­—ç¿»è­¯ â†’ Gloss ç”Ÿæˆ â†’ åœ–ç‰‡ç”Ÿæˆã€‚

**ç«¯é»**: `POST /api/translate-complete`

**è«‹æ±‚æ ¼å¼**:
```typescript
{
  text: string  // å¿…å¡«ï¼šè¦ç¿»è­¯çš„ä¸­æ–‡æ–‡å­—
}
```

**è«‹æ±‚ç¯„ä¾‹**:
```bash
curl -X POST http://localhost:3001/api/translate-complete \
  -H "Content-Type: application/json" \
  -d '{"text": "ä½ å¥½"}'
```

**å›æ‡‰ç¯„ä¾‹**:
```json
{
  "originalText": "ä½ å¥½",
  "gloss": "HELLO",
  "imageUrl": "https://oaidalleapiprodscus.blob.core.windows.net/...",
  "timestamp": "2024-01-01T00:00:00.000Z"
}
```

**èªªæ˜**:
- é€™æ˜¯å‰ç«¯ä¸»è¦ä½¿ç”¨çš„ç«¯é»
- è‡ªå‹•è™•ç†æ•´å€‹ç¿»è­¯æµç¨‹
- ç”Ÿæˆæ™‚é–“ç´„ 10-30 ç§’ï¼ˆå–æ±ºæ–¼ OpenAI API é€Ÿåº¦ï¼‰
- ç›¸åŒæ–‡å­—æœƒä½¿ç”¨å¿«å–ï¼Œå›æ‡‰æ›´å¿«

**ç‹€æ…‹ç¢¼**:
- `201 Created`: ç¿»è­¯æˆåŠŸ
- `400 Bad Request`: è«‹æ±‚æ ¼å¼éŒ¯èª¤
- `500 Internal Server Error`: è™•ç†éŒ¯èª¤

---

### 5. æäº¤ä½¿ç”¨è€…å›é¥‹

è¨˜éŒ„ä½¿ç”¨è€…å°ç”Ÿæˆçµæœçš„å›é¥‹ã€‚

**ç«¯é»**: `POST /api/postprocess`

**è«‹æ±‚æ ¼å¼**:
```typescript
{
  imageUrl: string,           // å¿…å¡«ï¼šåœ–ç‰‡ URL
  feedback?: 'like' | 'dislike' | 'report'  // é¸å¡«ï¼šå›é¥‹é¡å‹
}
```

**è«‹æ±‚ç¯„ä¾‹**:
```bash
curl -X POST http://localhost:3001/api/postprocess \
  -H "Content-Type: application/json" \
  -d '{
    "imageUrl": "https://example.com/image.png",
    "feedback": "like"
  }'
```

**å›æ‡‰ç¯„ä¾‹**:
```json
{
  "success": true,
  "message": "Thank you for your positive feedback!"
}
```

**å›é¥‹é¡å‹**:
- `like` (ğŸ‘): åœ–ç‰‡æº–ç¢ºï¼Œå“è³ªè‰¯å¥½
- `dislike` (ğŸ‘): åœ–ç‰‡ä¸æº–ç¢ºæˆ–å“è³ªä¸ä½³
- `report` (âš ï¸): ç™¼ç¾å•é¡Œéœ€è¦å›å ±

**ç‹€æ…‹ç¢¼**:
- `201 Created`: å›é¥‹å·²è¨˜éŒ„
- `400 Bad Request`: è«‹æ±‚æ ¼å¼éŒ¯èª¤

---

### 6. ç²å–çµ±è¨ˆè³‡æ–™

ç²å–å›é¥‹çµ±è¨ˆè³‡æ–™ï¼ˆç”¨æ–¼ç›£æ§ï¼‰ã€‚

**ç«¯é»**: `GET /api/stats`

**è«‹æ±‚ç¯„ä¾‹**:
```bash
curl http://localhost:3001/api/stats
```

**å›æ‡‰ç¯„ä¾‹**:
```json
{
  "total": 100,
  "likes": 75,
  "dislikes": 20,
  "reports": 5
}
```

**èªªæ˜**:
- `total`: ç¸½å›é¥‹æ•¸
- `likes`: æ­£é¢å›é¥‹æ•¸
- `dislikes`: è² é¢å›é¥‹æ•¸
- `reports`: å•é¡Œå›å ±æ•¸

**ç‹€æ…‹ç¢¼**:
- `200 OK`: æˆåŠŸç²å–çµ±è¨ˆ

---

## éŒ¯èª¤è™•ç†

### æ¨™æº–éŒ¯èª¤æ ¼å¼

```json
{
  "statusCode": 400,
  "message": "Validation failed",
  "error": "Bad Request"
}
```

### å¸¸è¦‹éŒ¯èª¤ç¢¼

| ç‹€æ…‹ç¢¼ | èªªæ˜ | è§£æ±ºæ–¹æ³• |
|--------|------|----------|
| 400 | è«‹æ±‚æ ¼å¼éŒ¯èª¤ | æª¢æŸ¥è«‹æ±‚åƒæ•¸æ ¼å¼ |
| 404 | ç«¯é»ä¸å­˜åœ¨ | æª¢æŸ¥ URL æ˜¯å¦æ­£ç¢º |
| 500 | ä¼ºæœå™¨å…§éƒ¨éŒ¯èª¤ | æª¢æŸ¥ OpenAI API Key æˆ–æŸ¥çœ‹æ—¥èªŒ |

---

## å¿«å–æ©Ÿåˆ¶

ç‚ºäº†æå‡æ•ˆèƒ½å’Œé™ä½ API æˆæœ¬ï¼Œç³»çµ±å¯¦ä½œäº†è¨˜æ†¶é«”å¿«å–ï¼š

- **ç¿»è­¯å¿«å–**: ç›¸åŒçš„ä¸­æ–‡æ–‡å­—æœƒè¿”å›å¿«å–çš„ Gloss
- **åœ–ç‰‡å¿«å–**: ç›¸åŒçš„ Gloss æœƒè¿”å›å¿«å–çš„åœ–ç‰‡ URL

### å¿«å–éµæ ¼å¼

```
translate:${text}   // ç¿»è­¯å¿«å–
image:${gloss}      // åœ–ç‰‡å¿«å–
```

### æ¸…é™¤å¿«å–

ç›®å‰éœ€è¦é‡å•Ÿæœå‹™å™¨æ¸…é™¤å¿«å–ã€‚æœªä¾†å¯å¯¦ä½œ API ç«¯é»æˆ–ä½¿ç”¨ Redisã€‚

---

## é€Ÿç‡é™åˆ¶

ç›®å‰æ²’æœ‰å¯¦ä½œé€Ÿç‡é™åˆ¶ã€‚å»ºè­°åœ¨ç”Ÿç”¢ç’°å¢ƒä¸­æ–°å¢ï¼š

- ä½¿ç”¨ `@nestjs/throttler`
- å»ºè­°é™åˆ¶ï¼šæ¯åˆ†é˜ 10 æ¬¡è«‹æ±‚
- æˆ–ä½¿ç”¨ API Gateway çš„é€Ÿç‡é™åˆ¶åŠŸèƒ½

---

## å®‰å…¨æ€§

### CORS è¨­å®š

- é–‹ç™¼ç’°å¢ƒï¼šå…è¨± `http://localhost:3000`
- ç”Ÿç”¢ç’°å¢ƒï¼šåœ¨ `apps/backend/src/main.ts` ä¸­è¨­å®šå…è¨±çš„ä¾†æº

### API Key ä¿è­·

- OpenAI API Key å­˜æ”¾åœ¨ç’°å¢ƒè®Šæ•¸ä¸­
- ä¸æ‡‰æš´éœ²åœ¨å‰ç«¯æˆ–å…¬é–‹ Repository

### è¼¸å…¥é©—è­‰

- ä½¿ç”¨ `class-validator` é©—è­‰æ‰€æœ‰è¼¸å…¥
- è‡ªå‹•éæ¿¾ä¸å¿…è¦çš„å±¬æ€§ï¼ˆ`whitelist: true`ï¼‰

---

## é–‹ç™¼å»ºè­°

### æ¸¬è©¦ API

ä½¿ç”¨æä¾›çš„æ¸¬è©¦è…³æœ¬ï¼š
```bash
./demo-api.sh
```

æˆ–ä½¿ç”¨ Postman / Insomnia ç­‰å·¥å…·ã€‚

### ç›£æ§

å»ºè­°æ–°å¢ï¼š
- æ—¥èªŒç³»çµ± (Winston)
- éŒ¯èª¤è¿½è¹¤ (Sentry)
- ç›£æ§å„€è¡¨æ¿ (Prometheus + Grafana)

### æ•ˆèƒ½å„ªåŒ–

æœªä¾†å¯è€ƒæ…®ï¼š
- ä½¿ç”¨ Redis æŒä¹…åŒ–å¿«å–
- æ–°å¢åœ–ç‰‡ CDN
- å¯¦ä½œè«‹æ±‚ä½‡åˆ—ï¼ˆè™•ç†å¤§é‡è«‹æ±‚ï¼‰

---

## è®Šæ›´æ—¥èªŒ

### v1.0.0 (2024-01)
- âœ… åˆå§‹ç‰ˆæœ¬
- âœ… å¯¦ä½œåŸºæœ¬ç¿»è­¯åŠŸèƒ½
- âœ… æ•´åˆ OpenAI API
- âœ… æ–°å¢å›é¥‹ç³»çµ±
- âœ… å¯¦ä½œè¨˜æ†¶é«”å¿«å–

---

## æ”¯æ´

å¦‚æœ‰å•é¡Œæˆ–å»ºè­°ï¼Œè«‹åœ¨ GitHub é–‹ Issueã€‚
